{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MallX Analytics | Store Management</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="stylesheet" href="{% static 'css/store.css'%}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Store cards styling */
        .store-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid #e9ecef;
        }
        
        .store-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }
        
        .store-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .store-category-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            text-transform: uppercase;
        }
        
        .store-status {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            font-weight: 500;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .status-dot.active { background: #28a745; }
        .status-dot.inactive { background: #dc3545; }
        .status-dot.maintenance { background: #ffc107; }
        
        .store-name {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .store-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin: 15px 0;
        }
        
        .store-detail-item {
            display: flex;
            flex-direction: column;
        }
        
        .detail-label {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 4px;
        }
        
        .detail-value {
            font-size: 14px;
            font-weight: 500;
            color: #495057;
        }
        
        .store-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e9ecef;
        }
        
        /* Loading and empty states */
        .loading-spinner {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }
        
        .loading-spinner i {
            font-size: 32px;
            margin-bottom: 16px;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 48px;
            margin-bottom: 16px;
            color: #adb5bd;
        }
        
        .empty-state h4 {
            font-size: 18px;
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
        }
        
        /* Store KPIs */
        .store-kpis {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .store-kpi-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            border: 1px solid #e9ecef;
        }
        
        .store-kpi-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }
        
        .store-kpi-header i {
            font-size: 24px;
            color: #4361ee;
        }
        
        .store-kpi-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }
        
        .store-kpi-subtitle {
            font-size: 13px;
            color: #6c757d;
            margin: 4px 0 0 0;
        }
        
        .store-kpi-value {
            font-size: 28px;
            font-weight: 700;
            color: #2c3e50;
            margin-bottom: 8px;
        }
        
        .store-kpi-change {
            font-size: 13px;
        }
        
        .change-positive {
            color: #28a745;
            font-weight: 500;
        }
        
        .change-label {
            color: #6c757d;
            margin-left: 6px;
        }
        
        /* Store grid */
        .stores-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        /* Filters */
        .category-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin: 15px 0;
        }
        
        .filter-btn {
            padding: 8px 16px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            color: #495057;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .filter-btn:hover {
            background: #e9ecef;
        }
        
        .filter-btn.active {
            background: #4361ee;
            color: white;
            border-color: #4361ee;
        }
        
        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            margin: 0;
            font-size: 20px;
            color: #2c3e50;
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 20px;
            color: #6c757d;
            cursor: pointer;
            padding: 4px;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        /* Forms */
        .store-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .form-group label {
            font-size: 14px;
            font-weight: 500;
            color: #495057;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 10px 12px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            color: #495057;
            background: white;
        }
        
        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #4361ee;
            box-shadow: 0 0 0 3px rgba(67, 97, 238, 0.1);
        }
        
        .form-actions {
            display: flex;
            justify-content: flex-end;
            gap: 12px;
            margin-top: 20px;
        }
        
        .btn-primary {
            padding: 10px 24px;
            background: #4361ee;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: background 0.2s;
        }
        
        .btn-primary:hover {
            background: #3a56d4;
        }
        
        .btn-secondary {
            padding: 10px 24px;
            background: #f8f9fa;
            color: #495057;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
        }
        
        /* Store Detail Modal */
        .store-detail-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .store-basic-info {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        
        .info-label {
            font-size: 13px;
            color: #6c757d;
        }
        
        .info-value {
            font-size: 15px;
            color: #2c3e50;
            font-weight: 500;
        }
        
        .store-description {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .store-description h4 {
            margin: 0 0 10px 0;
            color: #2c3e50;
        }
        
        .store-description p {
            margin: 0;
            color: #495057;
            line-height: 1.6;
        }
        
        /* Toast notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: 8px;
            padding: 16px 20px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 1001;
            animation: slideIn 0.3s ease-out;
            border-left: 4px solid #4361ee;
        }
        
        .toast.success {
            border-left-color: #28a745;
        }
        
        .toast.error {
            border-left-color: #dc3545;
        }
        
        .toast-icon {
            font-size: 20px;
        }
        
        .toast.success .toast-icon {
            color: #28a745;
        }
        
        .toast.error .toast-icon {
            color: #dc3545;
        }
        
        .toast-message {
            font-size: 14px;
            color: #2c3e50;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .store-kpis {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stores-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .store-basic-info {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .store-kpis {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Left Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-chart-line"></i>
                <h1>MallX Analytics</h1>
            </div>
            
            <nav class="main-nav">
                <ul>
                    <li>
                        <a href="{% url 'mall_management_system:index' %}">
                            <i class="fas fa-home"></i>
                            <span>Home</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'mall_management_system:dashboard' %}">
                            <i class="fas fa-store"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li class="active">
                        <a href="{% url 'mall_management_system:stores' %}">
                            <i class="fas fa-store"></i>
                            <span>Stores</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'mall_management_system:sales' %}">
                            <i class="fas fa-shopping-bag"></i>
                            <span>Sales</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'mall_management_system:customers' %}">
                            <i class="fas fa-users"></i>
                            <span>Customers</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'mall_management_system:inventory' %}">
                            <i class="fas fa-boxes"></i>
                            <span>Inventory</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <div class="calendar-widget">
                <h3><i class="fas fa-calendar-alt"></i> Stores Status</h3>
                <div class="store-status-summary" id="storeStatusSummary">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>
            
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="avatar">
                        <i class="fas fa-user-circle"></i>
                    </div>
                    <div class="user-details">
                        <span class="username">Admin User</span>
                        <span class="role">Mall Manager</span>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Navbar -->
            <header class="navbar">
                <div class="navbar-left">
                    <button class="menu-toggle" id="menuToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="page-title">
                        <h2>Store Management</h2>
                        <p class="date-range">Manage stores, leases, and performance analytics</p>
                    </div>
                </div>
                
                <div class="search-container">
                    <i class="fas fa-search"></i>
                    <input type="text" class="search-input" id="storeSearch" placeholder="Search stores by name, category, or location...">
                </div>
                
                <div class="navbar-right">
                    <button class="action-btn" id="addStoreBtn">
                        <i class="fas fa-plus-circle"></i> Add New Store
                    </button>
                </div>
            </header>
            
            <!-- Store Management Content -->
            <div class="stores-content">
                <!-- Store KPIs -->
                <section class="store-kpis" id="storeKpis">
                    <!-- Will be populated by JavaScript -->
                </section>
                
                <!-- Store Categories Filter -->
                <section class="store-categories">
                    <div class="section-header">
                        <h3>Store Categories</h3>
                        <div class="category-filters">
                            <button class="filter-btn active" data-category="all">All Stores</button>
                            {% for store in stores %}
                            <button class="filter-btn" data-category="{{ store.category }}">
                                {{ store.get_category_display }}
                            </button>
                            {% endfor %}
                        </div>
                    </div>
                </section>
                
                <!-- Stores Grid View -->
                <section class="stores-display">
                    <div class="stores-grid" id="storesGrid">
                        {% if stores %}
                            {% for store in stores %}
                            <div class="store-card" data-store-id="{{ store.store_id }}">
                                <div class="store-card-header">
                                    <span class="store-category-badge">
                                        {{ store.get_category_display }}
                                    </span>
                                    <span class="store-status">
                                        <span class="status-dot {{ store.status }}"></span>
                                        <span>{{ store.get_status_display }}</span>
                                    </span>
                                </div>
                                <div class="store-card-body">
                                    <h3 class="store-name">{{ store.name }}</h3>
                                    <div class="store-details">
                                        <div class="store-detail-item">
                                            <span class="detail-label">ID</span>
                                            <span class="detail-value">{{ store.store_id }}</span>
                                        </div>
                                        <div class="store-detail-item">
                                            <span class="detail-label">Location</span>
                                            <span class="detail-value">{{ store.get_location_display }}</span>
                                        </div>
                                        <div class="store-detail-item">
                                            <span class="detail-label">Size</span>
                                            <span class="detail-value">{{ store.size }} sq.ft</span>
                                        </div>
                                        <div class="store-detail-item">
                                            <span class="detail-label">Monthly Rent</span>
                                            <span class="detail-value">₹{{ store.monthly_rent }}</span>
                                        </div>
                                        <div class="store-detail-item">
                                            <span class="detail-label">Manager</span>
                                            <span class="detail-value">{{ store.manager }}</span>
                                        </div>
                                        <div class="store-detail-item">
                                            <span class="detail-label">Contact</span>
                                            <span class="detail-value">{{ store.contact_info }}</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="store-card-footer">
                                    <div class="store-hours">
                                        <span class="detail-label">Hours:</span>
                                        <span class="detail-value">{{ store.operating_hours }}</span>
                                    </div>
                                    <button class="btn-secondary view-details-btn" data-store-id="{{ store.store_id }}">
                                        View Details
                                    </button>
                                </div>
                            </div>
                            {% endfor %}
                        {% else %}
                            <div class="empty-state">
                                <i class="fas fa-store-slash"></i>
                                <h4>No Stores Found</h4>
                                <p>There are no stores in the database yet.</p>
                                <button class="btn-primary" id="addFirstStoreBtn">
                                    <i class="fas fa-plus-circle"></i> Add First Store
                                </button>
                            </div>
                        {% endif %}
                    </div>
                </section>
            </div>
        </main>
    </div>
    
    <!-- Add Store Modal -->
    <div class="modal" id="addStoreModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Store</h3>
                <button class="modal-close" id="closeStoreModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="addStoreForm" class="store-form" method="POST" action=" ">
                    {% csrf_token %}
                    <div class="form-row">
                        <div class="form-group">
                            <label for="storeName">
                                <i class="fas fa-signature"></i> Store Name *
                            </label>
                            <input 
                                type="text" 
                                id="storeName" 
                                name="name"
                                placeholder="Enter store name"
                                required
                            >
                        </div>
                        
                        <div class="form-group">
                            <label for="storeCategory">
                                <i class="fas fa-tags"></i> Category *
                            </label>
                            <select id="storeCategory" name="category" required>
                                <option value="">Select Category</option>
                                <option value="electronics">Electronics</option>
                                <option value="fashion">Fashion</option>
                                <option value="food">Food</option>
                                <option value="entertainment">Entertainment</option>
                                <option value="beauty">Beauty</option>
                                <option value="home">Home</option>
                                <option value="sports">Sports</option>
                                <option value="books">Books</option>
                                <option value="jewelry">Jewelry</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="storeLocation">
                                <i class="fas fa-map-marker-alt"></i> Location *
                            </label>
                            <select id="storeLocation" name="location" required>
                                <option value="">Select Location</option>
                                <option value="GF-N">Ground Floor - North Wing</option>
                                <option value="GF-S">Ground Floor - South Wing</option>
                                <option value="GF-E">Ground Floor - East Wing</option>
                                <option value="GF-W">Ground Floor - West Wing</option>
                                <option value="1F-N">First Floor - North Wing</option>
                                <option value="1F-S">First Floor - South Wing</option>
                                <option value="1F-E">First Floor - East Wing</option>
                                <option value="1F-W">First Floor - West Wing</option>
                                <option value="2F-N">Second Floor - North Wing</option>
                                <option value="2F-S">Second Floor - South Wing</option>
                                <option value="2F-E">Second Floor - East Wing</option>
                                <option value="2F-W">Second Floor - West Wing</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="storeStatus">
                                <i class="fas fa-circle"></i> Status *
                            </label>
                            <select id="storeStatus" name="status" required>
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="maintenance">Maintenance</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="storeSize">
                                <i class="fas fa-arrows-alt"></i> Store Size (sq. ft.) *
                            </label>
                            <input 
                                type="number" 
                                id="storeSize" 
                                name="size"
                                placeholder="e.g., 1500"
                                min="100"
                                max="10000"
                                required
                            >
                        </div>
                        
                        <div class="form-group">
                            <label for="monthlyRent">
                                <i class="fas fa-rupee-sign"></i> Monthly Rent (₹) *
                            </label>
                            <input 
                                type="number" 
                                id="monthlyRent" 
                                name="monthly_rent"
                                placeholder="e.g., 50000"
                                min="1000"
                                step="1000"
                                required
                            >
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="storeManager">
                                <i class="fas fa-user-tie"></i> Store Manager *
                            </label>
                            <input 
                                type="text" 
                                id="storeManager" 
                                name="manager"
                                placeholder="Manager's name"
                                required
                            >
                        </div>
                        
                        <div class="form-group">
                            <label for="storeContact">
                                <i class="fas fa-phone"></i> Contact Information *
                            </label>
                            <input 
                                type="text" 
                                id="storeContact" 
                                name="contact_info"
                                placeholder="Phone number or email"
                                required
                            >
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="storeDescription">
                            <i class="fas fa-align-left"></i> Store Description
                        </label>
                        <textarea 
                            id="storeDescription" 
                            name="description"
                            rows="3"
                            placeholder="Brief description of the store, products/services offered..."
                        ></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label for="storeHours">
                            <i class="fas fa-clock"></i> Operating Hours
                        </label>
                        <input 
                            type="text" 
                            id="storeHours" 
                            name="operating_hours"
                            placeholder="e.g., 10:00 AM - 9:00 PM"
                            value="10:00 AM - 9:00 PM"
                        >
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn-secondary" id="cancelStoreBtn">
                            Cancel
                        </button>
                        <button type="submit" class="btn-primary">
                            <i class="fas fa-plus-circle"></i> Add Store
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Store Detail Modal -->
    <div class="modal" id="storeDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="detailStoreName">Store Details</h3>
                <button class="modal-close" id="closeDetailModal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="store-detail-content" id="storeDetailContent">
                    <!-- Store details will be populated here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification Container -->
    <div id="toastContainer"></div>

    <script>
        // Simple Store Management JavaScript
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize store KPIs with data from Django context
            initializeStoreKPIs();
            
            // Setup event listeners
            setupEventListeners();
            
            // Initialize store cards with search functionality
            initializeStoreSearch();
            
            // Initialize category filters
            initializeCategoryFilters();
        });
        
        function initializeStoreKPIs() {
            const kpisContainer = document.getElementById('storeKpis');
            const stats = {{ stats|safe }};
            
            kpisContainer.innerHTML = `
                <div class="store-kpi-card">
                    <div class="store-kpi-header">
                        <i class="fas fa-store"></i>
                        <div>
                            <h3>Total Stores</h3>
                            <p class="store-kpi-subtitle">Across all categories</p>
                        </div>
                    </div>
                    <div class="store-kpi-value">${stats.total_stores}</div>
                    <div class="store-kpi-change">
                        <span class="change-positive">${stats.active_stores} active</span>
                    </div>
                </div>
                
                <div class="store-kpi-card">
                    <div class="store-kpi-header">
                        <i class="fas fa-expand-arrows-alt"></i>
                        <div>
                            <h3>Avg. Store Size</h3>
                            <p class="store-kpi-subtitle">Square feet</p>
                        </div>
                    </div>
                    <div class="store-kpi-value">${stats.avg_size} sq.ft</div>
                    <div class="store-kpi-change">
                        <span class="change-label">Average size</span>
                    </div>
                </div>
                
                <div class="store-kpi-card">
                    <div class="store-kpi-header">
                        <i class="fas fa-rupee-sign"></i>
                        <div>
                            <h3>Avg. Monthly Rent</h3>
                            <p class="store-kpi-subtitle">Per store</p>
                        </div>
                    </div>
                    <div class="store-kpi-value">₹${stats.avg_rent}</div>
                    <div class="store-kpi-change">
                        <span class="change-label">Average rent</span>
                    </div>
                </div>
                
                <div class="store-kpi-card">
                    <div class="store-kpi-header">
                        <i class="fas fa-chart-line"></i>
                        <div>
                            <h3>Occupancy Rate</h3>
                            <p class="store-kpi-subtitle">Mall capacity</p>
                        </div>
                    </div>
                    <div class="store-kpi-value">${stats.occupancy_rate}%</div>
                    <div class="store-kpi-change">
                        <span class="change-label">Current occupancy</span>
                    </div>
                </div>
            `;
            
            // Update sidebar status
            const statusContainer = document.getElementById('storeStatusSummary');
            statusContainer.innerHTML = `
                <div class="status-item">
                    <i class="fas fa-door-open" style="color: #28a745;"></i>
                    <div>
                        <span style="font-weight: bold; font-size: 18px;">${stats.active_stores}</span>
                        <div style="font-size: 12px; color: #6c757d;">Active</div>
                    </div>
                </div>
                <div class="status-item">
                    <i class="fas fa-door-closed" style="color: #dc3545;"></i>
                    <div>
                        <span style="font-weight: bold; font-size: 18px;">${stats.inactive_stores}</span>
                        <div style="font-size: 12px; color: #6c757d;">Inactive</div>
                    </div>
                </div>
                ${stats.maintenance_stores > 0 ? `
                <div class="status-item">
                    <i class="fas fa-tools" style="color: #ffc107;"></i>
                    <div>
                        <span style="font-weight: bold; font-size: 18px;">${stats.maintenance_stores}</span>
                        <div style="font-size: 12px; color: #6c757d;">Maintenance</div>
                    </div>
                </div>
                ` : ''}
            `;
        }
        
        function setupEventListeners() {
            // Add store button
            document.getElementById('addStoreBtn').addEventListener('click', () => {
                document.getElementById('addStoreModal').classList.add('active');
            });
            
            document.getElementById('addFirstStoreBtn')?.addEventListener('click', () => {
                document.getElementById('addStoreModal').classList.add('active');
            });
            
            // Close modal buttons
            document.getElementById('closeStoreModal').addEventListener('click', () => {
                document.getElementById('addStoreModal').classList.remove('active');
            });
            
            document.getElementById('closeDetailModal').addEventListener('click', () => {
                document.getElementById('storeDetailModal').classList.remove('active');
            });
            
            document.getElementById('cancelStoreBtn').addEventListener('click', () => {
                document.getElementById('addStoreModal').classList.remove('active');
            });
            
            // Close modals when clicking outside
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });
            
            // Handle form submission
            document.getElementById('addStoreForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const form = e.target;
                const formData = new FormData(form);
                
                fetch(form.action, {
                    method: 'POST',
                    body: JSON.stringify(Object.fromEntries(formData)),
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken')
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showToast('Store added successfully!', 'success');
                        document.getElementById('addStoreModal').classList.remove('active');
                        form.reset();
                        // Reload page to show new store
                        setTimeout(() => location.reload(), 1500);
                    } else {
                        showToast('Error: ' + data.error, 'error');
                    }
                })
                .catch(error => {
                    showToast('Error adding store: ' + error.message, 'error');
                });
            });
            
            // Menu toggle
            document.getElementById('menuToggle').addEventListener('click', () => {
                document.querySelector('.sidebar').classList.toggle('collapsed');
            });
            
            // View details buttons
            document.querySelectorAll('.view-details-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const storeId = this.dataset.storeId;
                    showStoreDetails(storeId);
                });
            });
        }
        
        function initializeStoreSearch() {
            const searchInput = document.getElementById('storeSearch');
            searchInput.addEventListener('input', function() {
                const searchTerm = this.value.toLowerCase();
                const storeCards = document.querySelectorAll('.store-card');
                
                storeCards.forEach(card => {
                    const storeName = card.querySelector('.store-name').textContent.toLowerCase();
                    const storeCategory = card.querySelector('.store-category-badge').textContent.toLowerCase();
                    const storeLocation = card.querySelector('.store-detail-item:nth-child(2) .detail-value').textContent.toLowerCase();
                    const storeManager = card.querySelector('.store-detail-item:nth-child(5) .detail-value').textContent.toLowerCase();
                    
                    const matches = storeName.includes(searchTerm) || 
                                   storeCategory.includes(searchTerm) || 
                                   storeLocation.includes(searchTerm) || 
                                   storeManager.includes(searchTerm);
                    
                    card.style.display = matches ? 'block' : 'none';
                });
            });
        }
        
        function initializeCategoryFilters() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    // Update active button
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    const category = this.dataset.category;
                    const storeCards = document.querySelectorAll('.store-card');
                    
                    if (category === 'all') {
                        storeCards.forEach(card => card.style.display = 'block');
                    } else {
                        storeCards.forEach(card => {
                            const cardCategory = card.querySelector('.store-category-badge').textContent.toLowerCase();
                            card.style.display = cardCategory === category.toLowerCase() ? 'block' : 'none';
                        });
                    }
                });
            });
        }
        
        async function showStoreDetails(storeId) {
            try {
                const response = await fetch(`/api/stores/${storeId}/`);
                const data = await response.json();
                
                if (data.success) {
                    const store = data.store;
                    document.getElementById('detailStoreName').textContent = store.name;
                    
                    const detailHTML = `
                        <div class="store-basic-info">
                            <div class="info-item">
                                <span class="info-label">Store ID</span>
                                <span class="info-value">${store.id}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Category</span>
                                <span class="info-value">${store.category_display || store.category}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Location</span>
                                <span class="info-value">${store.location_display || store.location}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Status</span>
                                <span class="info-value">${store.status_display || store.status}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Store Size</span>
                                <span class="info-value">${store.size} sq.ft</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Monthly Rent</span>
                                <span class="info-value">₹${store.monthlyRent || store.monthly_rent}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Manager</span>
                                <span class="info-value">${store.manager || store.owner}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Contact</span>
                                <span class="info-value">${store.contact || store.contact_info}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Operating Hours</span>
                                <span class="info-value">${store.hours || store.operating_hours || '10:00 AM - 9:00 PM'}</span>
                            </div>
                            <div class="info-item">
                                <span class="info-label">Created</span>
                                <span class="info-value">${store.created_at}</span>
                            </div>
                        </div>
                        
                        ${store.description ? `
                        <div class="store-description">
                            <h4>Description</h4>
                            <p>${store.description}</p>
                        </div>
                        ` : ''}
                    `;
                    
                    document.getElementById('storeDetailContent').innerHTML = detailHTML;
                    document.getElementById('storeDetailModal').classList.add('active');
                } else {
                    showToast('Error loading store details', 'error');
                }
            } catch (error) {
                showToast('Error loading store details: ' + error.message, 'error');
            }
        }
        
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <div class="toast-icon">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                </div>
                <div class="toast-message">${message}</div>
            `;
            
            container.appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                toast.remove();
            }, 5000);
        }
        
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
</body>
</html>